---
import { getCollection, render } from 'astro:content';
import Layout from "../layouts/default.astro"
import PostBody from '../components/post-body.astro'
import PostCard from '../components/post-card.astro'

const posts = (await getCollection('posts')).sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
const latestPost = posts[0];
const recentPosts = posts
	.filter(({ id }) => id !== latestPost.id)
	.slice(0, 2);

const { Content } = await render(latestPost);
---

<Layout>
	<PostBody {...latestPost.data}>
		<Content />
	</PostBody>
	<h3>Recent posts</h3>
	<section class="post-list">
    {recentPosts.map((post) => (
      <PostCard {...post.data} href={`/posts/${post.id}`} />
    ))}
  </section>
</Layout>
